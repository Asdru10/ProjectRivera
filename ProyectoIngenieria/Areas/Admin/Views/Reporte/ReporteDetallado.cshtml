@model ProyectoIngenieria.Models.ViewModels.ReporteDetalladoVM


@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
}

@{
    ViewData["Title"] = "Reporte Detallado de Vehículo";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<div class="container mt-5 mb-5" style="max-width: 1200px;">
    <div class="text-center border-bottom pb-3 mb-4">
        <h2 class="fw-bold text-primary">REPORTE DETALLADO DE VEHÍCULO</h2>
        <p class="text-muted">Generado el @Model.Fecha_reporte</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <strong>Marca:</strong> @Model.Marca
        </div>
        <div class="col-md-4">
            <strong>Modelo:</strong> @Model.Modelo
        </div>
        <div class="col-md-4">
            <strong>Placa:</strong> @Model.Placa
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <strong>Periodo analizado:</strong> @Model.Periodo
        </div>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white fw-semibold">Resumen General</div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col">
                    <h6>Total Horas</h6>
                    <p>@Model.TotalHorasTrabajo</p>
                </div>
                <div class="col">
                    <h6>Ingreso generado</h6>
                    <p>₡@Model.TotalIngresos.ToString("N2")</p>
                </div>
                <div class="col">
                    <h6>Gasto en Combustible</h6>
                    <p>₡@Model.GastoCombustible.ToString("N2")</p>
                </div>
                <div class="col">
                    <h6>Gasto en Mantenimiento</h6>
                    <p>₡@Model.GastoMantenimiento.ToString("N2")</p>
                </div>
                <div class="col">
                    <h6>Utilidad</h6>
                    @if (Model.Utilidad < 0)
                    {
                        <p class="fw-bold text-danger">₡@Model.Utilidad.ToString("N2")</p>
                    }
                    else
                    {
                        <p class="fw-bold text-success">₡@Model.Utilidad.ToString("N2")</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="mb-5">
        <h5 class="text-primary fw-bold mb-3">Horas de Trabajo</h5>
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-light">
                <tr>
                    <th>Fecha</th>
                    <th>Proyecto</th>
                    <th>Lugar</th>
                    <th>Tipo</th>
                    <th>Horas</th>
                    <th>₡/Precio por Hora</th>
                    <th>Ingreso</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var trabajo in Model.HorasTrabajos)
                {
                    <tr>
                        <td>@trabajo.Fecha.ToString("dd/MM/yyyy")</td>
                        <td>@trabajo.Proyecto?.NombreProyecto</td>
                        <td>@trabajo.LugarTrabajo?.Nombre</td>
                        <td>@trabajo.TipoTrabajo?.Nombre</td>
                        <td>@trabajo.TotalHoras</td>
                        <td>₡@trabajo.PrecioHora.ToString("N2")</td>
                        <td>₡@trabajo.TotalGanancia.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mb-5">
        <h5 class="text-primary fw-bold mb-3">Mantenimientos Realizados</h5>
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-light">
                <tr>
                    <th>Fecha</th>
                    <th>Descripción</th>
                    <th>Precio</th>
                    <th>Actividades y Colaborador</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var mantenimiento in Model.Mantenimientos)
                {
                    <tr>
                        <td>@mantenimiento.Fecha.ToString("dd/MM/yyyy")</td>
                        <td>@mantenimiento.Descripcion</td>
                        <td>₡@mantenimiento.Precio.ToString("N2")</td>
                        <td>
                            <ul class="mb-0">
                                @foreach (var detalle in mantenimiento.OperadorMantenimientos)
                                {
                                    <li>
                                        @detalle.CatalogoMantenimiento?.Nombre - Colaborador: @detalle.OperadorCedulaNavigation?.Nombre
                                    </li>
                                }
                            </ul>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mb-5">
        <h5 class="text-primary fw-bold mb-3">Compras de Combustible</h5>
        <table class="table table-bordered table-sm align-middle">
            <thead class="table-light">
                <tr>
                    <th>Fecha</th>
                    <th>Litros</th>
                    <th>Precio por Litro</th>
                    <th>Total Pagado</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var combustible in Model.Combustibles)
                {
                    <tr>
                        <td>@combustible.FechaCompra.ToString("dd/MM/yyyy")</td>
                        <td>@combustible.LitrosComprados.ToString("N2")</td>
                        <td>₡@combustible.PrecioLitro.ToString("N2")</td>
                        <td>₡@combustible.TotalPagado.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-end mt-4">
        <a asp-controller="Reporte"
           asp-action="DescargarPDF"
           asp-route-id="@Model.VehiculoId"
           asp-route-fechaInicio="@Model.fechaInicio"
           asp-route-fechaFin="@Model.fechaFin"
           class="btn btn-info"
           target="_blank">
            Descargar PDF
        </a>
    </div>
    <a asp-controller="Reporte" asp-action="Index"
       class="btn btn-outline-success rounded-circle shadow p-3"
       style="position: fixed; bottom: 30px; right: 30px; z-index: 1050; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
        <i class="bi bi-arrow-left"></i>
    </a>
</div>


